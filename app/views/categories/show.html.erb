<% content_for :title, "#{@category.label} - 카테고리 상세" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "카테고리", categories_path %></li>
        <li class="breadcrumb-item active" aria-current="page"><%= @category.label %></li>
      </ol>
    </nav>
    <h1 class="h3 mb-1">
      <%= @category.label %>
      <% unless @category.is_active? %>
        <span class="badge bg-secondary">비활성</span>
      <% end %>
    </h1>
    <p class="text-muted mb-0"><%= @category.description %></p>
  </div>
  <div>
    <%= link_to "수정", edit_category_path(@category), class: "btn btn-outline-primary" %>
    <%= link_to "새 필드 추가", new_standard_field_path(category: @category.name), class: "btn btn-primary" %>
  </div>
</div>

<!-- Statistics -->
<div class="row mb-4">
  <div class="col-md-3 col-sm-6 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-primary"><%= @field_stats[:total] %></h5>
        <p class="card-text small text-muted">총 필드</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-success"><%= @field_stats[:active] %></h5>
        <p class="card-text small text-muted">활성 필드</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-warning"><%= @field_stats[:required] %></h5>
        <p class="card-text small text-muted">필수 필드</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-info"><%= @category.sort_order %></h5>
        <p class="card-text small text-muted">정렬 순서</p>
      </div>
    </div>
  </div>
</div>

<!-- Category Information -->
<div class="row mb-4">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">카테고리 정보</h5>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-3">카테고리명:</dt>
          <dd class="col-sm-9"><code><%= @category.name %></code></dd>

          <dt class="col-sm-3">표시명:</dt>
          <dd class="col-sm-9"><%= @category.label %></dd>

          <dt class="col-sm-3">설명:</dt>
          <dd class="col-sm-9">
            <%= @category.description.present? ? @category.description : '설명이 없습니다.' %>
          </dd>

          <dt class="col-sm-3">상태:</dt>
          <dd class="col-sm-9">
            <% if @category.is_active? %>
              <span class="badge bg-success">활성</span>
            <% else %>
              <span class="badge bg-secondary">비활성</span>
            <% end %>
          </dd>

          <dt class="col-sm-3">생성일:</dt>
          <dd class="col-sm-9"><%= @category.created_at.strftime('%Y년 %m월 %d일 %H:%M') %></dd>

          <dt class="col-sm-3">수정일:</dt>
          <dd class="col-sm-9"><%= @category.updated_at.strftime('%Y년 %m월 %d일 %H:%M') %></dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">빠른 작업</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <%= link_to "새 필드 추가", new_standard_field_path(category: @category.name), class: "btn btn-primary" %>
          <%= link_to "모든 표준 필드 보기", standard_fields_path, class: "btn btn-outline-secondary" %>
          <%= link_to "카테고리 수정", edit_category_path(@category), class: "btn btn-outline-primary" %>
          <% if @category.fields_count == 0 %>
            <%= link_to "카테고리 삭제", category_path(@category), method: :delete,
                confirm: "정말 삭제하시겠습니까?", class: "btn btn-outline-danger" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Fields List -->
<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0">이 카테고리의 필드 목록</h5>
      <%= link_to "새 필드 추가", new_standard_field_path(category: @category.name), class: "btn btn-sm btn-primary" %>
    </div>
  </div>
  <div class="card-body">
    <% if @fields.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>순서</th>
              <th>필드명</th>
              <th>표시명</th>
              <th>데이터 타입</th>
              <th>필수여부</th>
              <th>상태</th>
              <th>설명</th>
              <th>작업</th>
            </tr>
          </thead>
          <tbody>
            <% @fields.each do |field| %>
              <tr class="<%= 'table-secondary' unless field.is_active? %>">
                <td>
                  <span class="badge bg-light text-dark"><%= field.sort_order %></span>
                </td>
                <td>
                  <code><%= field.name %></code>
                </td>
                <td>
                  <%= field.label %>
                  <% if field.is_required? %>
                    <span class="text-danger">*</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-info"><%= field.data_type_humanized %></span>
                </td>
                <td>
                  <% if field.is_required? %>
                    <span class="badge bg-warning">필수</span>
                  <% else %>
                    <span class="badge bg-light text-dark">선택</span>
                  <% end %>
                </td>
                <td>
                  <% if field.is_active? %>
                    <span class="badge bg-success">활성</span>
                  <% else %>
                    <span class="badge bg-secondary">비활성</span>
                  <% end %>
                </td>
                <td>
                  <small class="text-muted">
                    <%= truncate(field.description, length: 50) if field.description.present? %>
                  </small>
                </td>
                <td>
                  <div class="btn-group btn-group-sm" role="group">
                    <%= link_to "보기", standard_field_path(field), class: "btn btn-outline-primary btn-sm" %>
                    <%= link_to "수정", edit_standard_field_path(field), class: "btn btn-outline-secondary btn-sm" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-4">
        <i class="fas fa-plus-circle fa-2x text-muted mb-2"></i>
        <p class="text-muted">이 카테고리에는 아직 필드가 없습니다.</p>
        <%= link_to "첫 번째 필드 추가", new_standard_field_path(category: @category.name), class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
